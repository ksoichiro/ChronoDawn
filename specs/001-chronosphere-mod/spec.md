# Feature Specification: Chronosphere Mod - 時間操作をテーマにしたMinecraft Modの開発

**Feature Branch**: `001-chronosphere-mod`
**Created**: 2025-10-18
**Status**: Draft
**Input**: User description: "Minecraftのmodを開発してください。ベースとなるアイデアは @DRAFT.md に記述されています。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ディメンションへの初回突入と帰還路の確保 (Priority: P1)

プレイヤーはオーバーワールドの古代遺跡でクロックストーンと時の砂時計の設計図を発見し、ポータルを作成してクロノスフィアに突入する。しかし、突入直後にポータルが機能停止し、プレイヤーは閉じ込められる。プレイヤーは忘れられた図書館でポータル安定化装置の設計図を発見し、これを作成・使用することでオーバーワールドへの自由な往来を確保する。

**Why this priority**: Modの基本的なゲームループ(ディメンション往復)を確立する最重要フェーズ。これがないとプレイヤーはディメンション内で閉じ込められたままになり、Modとして成立しない。

**Independent Test**: オーバーワールドで古代遺跡を発見し、ポータルを作成してクロノスフィアに突入できること。ディメンション内で生存に必要な食料(時間の果実)を入手でき、忘れられた図書館でポータル安定化装置の設計図を発見できること。安定化装置を作成してポータルを修復し、オーバーワールドとクロノスフィアを自由に往来できることを確認。

**Acceptance Scenarios**:

1. **Given** プレイヤーがオーバーワールドにいる, **When** 古代遺跡を探索する, **Then** クロックストーンと時の砂時計の設計図を発見できる
2. **Given** プレイヤーが時の砂時計を作成した, **When** ポータルを起動する, **Then** クロノスフィアに突入できる
3. **Given** プレイヤーがクロノスフィアに突入した, **When** 突入が完了する, **Then** ポータルが機能停止し、通常の手段では帰還できない状態になる
4. **Given** プレイヤーがクロノスフィアにいる, **When** 忘れられた図書館を探索する, **Then** ポータル安定化装置の設計図を発見できる
5. **Given** プレイヤーがポータル安定化装置を作成した, **When** 機能停止したポータルに使用する, **Then** ポータルが修復され、オーバーワールドへ自由に帰還できるようになる
6. **Given** プレイヤーがクロノスフィア内にいる, **When** 時間の果実を入手・使用する, **Then** 満腹度が回復し、採掘速度が一時的に上昇する

---

### User Story 2 - 時間操作アイテムの獲得とボス戦への準備 (Priority: P2)

プレイヤーは砂漠の時計塔を探索し、強化クロックストーンを入手する。これを使用して時間操作アイテム(タイムクロック、空間連結ツルハシなど)を作成し、戦闘と採掘の効率を向上させる。その後、時の番人(中ボス)を撃破してマスタークロックへの鍵を入手する。

**Why this priority**: P1で確立した基本ループに戦略性と進行感を追加する。時間操作アイテムはプレイヤーに「時間を操作している」という実感を与え、Modの独自性を強化する。

**Independent Test**: 砂漠の時計塔を探索して強化クロックストーンを入手できること。タイムクロックや空間連結ツルハシなどの時間操作アイテムを作成できること。タイムクロックを使用して周囲のMobの攻撃をキャンセルできること。空間連結ツルハシで採掘時にドロップが増加することを確認。時の番人を発見し、戦闘に勝利してマスタークロックへの鍵を入手できることを確認。

**Acceptance Scenarios**:

1. **Given** プレイヤーがクロノスフィアにいる, **When** 砂漠の時計塔を探索する, **Then** 強化クロックストーンを入手できる
2. **Given** プレイヤーが強化クロックストーンを入手した, **When** レシピに従ってクラフトする, **Then** タイムクロック、空間連結ツルハシなどの時間操作アイテムを作成できる
3. **Given** プレイヤーがタイムクロックを所持している, **When** 使用する(クールダウンあり), **Then** 周囲のMobの次の攻撃AIルーチンが強制的にキャンセルされる
4. **Given** プレイヤーが空間連結ツルハシを所持している, **When** ブロックを破壊する, **Then** 確率でドロップアイテムが2倍になる
5. **Given** プレイヤーが時間操作アイテムを所持している, **When** 時の番人と戦闘する, **Then** 時の番人を撃破し、マスタークロックへの鍵を入手できる

---

### User Story 3 - ラスボス撃破と最終報酬の獲得 (Priority: P3)

プレイヤーはマスタークロックへの鍵を使用して最深部に到達し、ラスボス「時間の暴君」と戦闘する。暴君を撃破すると静止のコアが破壊され、クロノスフィアの時間が安定化する。プレイヤーは報酬として「クロノスの瞳」を獲得し、究極のアーティファクト(クロノブレード、時の番人のメイルなど)を作成できるようになる。

**Why this priority**: Modのエンドゲームコンテンツであり、全てのストーリーと探索の集大成。P1とP2が完成していれば、これがなくてもModとして遊べるが、これがあることで完全な達成感を提供する。

**Independent Test**: マスタークロックへの鍵を使用してマスタークロック最深部に到達できること。時間の暴君と戦闘し、撃破できること。撃破後に静止のコアが破壊され、クロノスの瞳を獲得できること。クロノスの瞳と静止のコアの破片を使用して究極のアーティファクト(クロノブレード、時の番人のメイル、時間の残響ブーツ、空間連結ツルハシ、不安定な懐中時計)を作成できることを確認。

**Acceptance Scenarios**:

1. **Given** プレイヤーがマスタークロックへの鍵を所持している, **When** マスタークロックの入口で使用する, **Then** 最深部への道が開かれる
2. **Given** プレイヤーがマスタークロック最深部に到達した, **When** 時間の暴君と戦闘する, **Then** 時間の暴君を撃破できる
3. **Given** プレイヤーが時間の暴君を撃破した, **When** 撃破が完了する, **Then** 静止のコアが破壊され、クロノスの瞳と静止のコアの破片を獲得できる
4. **Given** プレイヤーがクロノスの瞳を獲得した, **When** クロノスフィアに滞在する, **Then** ディメンション内のMobの速度低下がさらに強化され、探索が安定化する
5. **Given** プレイヤーが静止のコアの破片を所持している, **When** レシピに従ってクラフトする, **Then** 究極のアーティファクト(クロノブレード、時の番人のメイル、時間の残響ブーツなど)を作成できる
6. **Given** プレイヤーがクロノブレードを所持している, **When** Mobに攻撃を命中させる, **Then** 確率でMobの次の攻撃AIがスキップされ、一方的な攻撃機会が生まれる
7. **Given** プレイヤーが時の番人のメイルを装備している, **When** 致命的なダメージを受ける, **Then** 確率でダメージ前のHPと位置にロールバックされ、即死を回避できる
8. **Given** プレイヤーが時間の残響ブーツを装備している, **When** ダッシュする, **Then** 敵のターゲットを引くデコイ(残像エンティティ)が短時間召喚される
9. **Given** プレイヤーが不安定な懐中時計を所持している, **When** 使用する, **Then** 周囲のMobとプレイヤーの速度ステータス効果が瞬時に入れ替わる

---

### Edge Cases

- プレイヤーがポータル安定化装置を作成せずにクロノスフィアで死亡した場合、どのように脱出するか?(リスポーン処理の設定)
- ポータルが複数ある場合、どのポータルが安定化されるか?(最も近いポータル、または作成順など)
- 時の番人を倒さずにマスタークロックに到達しようとした場合、どうなるか?(鍵が必要なため進行不可)
- クロノブレードや時の番人のメイルの確率発動はどの程度の頻度か?(10%、25%、50%など - バランス調整が必要)
- 反転共鳴が発動した際、プレイヤーが安全地帯に逃げ込めない場合のリスク軽減策は?(効果時間の調整、警告表示など)
- 不安定な砂岩が修復される間に他のブロックが配置された場合の挙動は?(配置したブロックを破壊して元に戻す、または修復をスキップする)
- 時間の果実の採掘速度上昇効果は既存のHasteエンチャントと重複するか?(重複する、または上限を設ける)
- プレイヤーが不安定な懐中時計を連続使用した場合、速度効果が蓄積されるか?(効果の上書き、またはクールダウンの設定)

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはオーバーワールドに古代遺跡を生成し、プレイヤーがクロックストーンと時の砂時計の設計図を発見できるようにしなければならない
- **FR-002**: プレイヤーは時の砂時計を作成し、ポータルを起動してクロノスフィアディメンションに突入できなければならない
- **FR-003**: プレイヤーがクロノスフィアに突入した直後、ポータルは機能停止し、プレイヤーは通常の手段では帰還できない状態にならなければならない
- **FR-004**: クロノスフィア内に忘れられた図書館を生成し、プレイヤーがポータル安定化装置の設計図を発見できるようにしなければならない
- **FR-005**: プレイヤーはポータル安定化装置を作成し、機能停止したポータルに使用することで、オーバーワールドとクロノスフィアを自由に往来できるようにしなければならない
- **FR-006**: クロノスフィア内の大半のカスタムMobに恒常的な極端な速度低下(Slowness IV～V相当)を付与し、プレイヤーは通常の速度で行動できなければならない
- **FR-007**: クロノスフィア内に時間の果実を生成し、プレイヤーが入手・使用することで満腹度を回復し、一時的に採掘速度を上昇(Haste I相当)させなければならない
- **FR-008**: 特定のブロック(逆流の砂岩など)の破壊イベントをフックし、数秒後に元のブロックに修復する処理を実行しなければならない。修復完了までドロップアイテムの放出を停止しなければならない
- **FR-009**: 不安定な菌糸ブロックのエンティティ衝突イベントをフックし、衝突したプレイヤーにランダムな速度効果(Speed IまたはSlowness I)を0.5秒間付与しなければならない
- **FR-010**: プレイヤーが不安定な砂時計を作成した際、または中ボス・ラスボスを撃破した直後の短時間(30秒～1分)に限定して反転共鳴を発動し、プレイヤーにSlowness IV、周囲のMobにSpeed IIを付与しなければならない
- **FR-011**: クロノスフィア内に砂漠の時計塔を生成し、プレイヤーが強化クロックストーンを入手できるようにしなければならない
- **FR-012**: プレイヤーは強化クロックストーンを使用してタイムクロック、空間連結ツルハシなどの時間操作アイテムを作成できなければならない
- **FR-013**: タイムクロックを使用すると、周囲のMobの次の攻撃AIルーチンを強制的にキャンセルしなければならない(クールダウンあり)
- **FR-014**: 空間連結ツルハシでブロックを破壊すると、確率でドロップアイテム生成処理を二重に実行しなければならない
- **FR-015**: クロノスフィア内に中ボス「時の番人」を生成し、プレイヤーが撃破するとマスタークロックへの鍵を入手できなければならない
- **FR-016**: マスタークロックへの鍵を使用すると、マスタークロック最深部への道が開かれなければならない
- **FR-017**: マスタークロック最深部にラスボス「時間の暴君」を生成し、プレイヤーが撃破すると静止のコアが破壊され、クロノスの瞳と静止のコアの破片を獲得できなければならない
- **FR-018**: クロノスの瞳を獲得すると、クロノスフィア内のMobの基本速度低下効果がさらに強化されなければならない
- **FR-019**: 静止のコアの破片を使用して究極のアーティファクト(クロノブレード、時の番人のメイル、時間の残響ブーツ、空間連結ツルハシの強化版、不安定な懐中時計)を作成できなければならない
- **FR-020**: クロノブレードで攻撃を命中させると、確率でMobの次の攻撃AIを強制的にスキップしなければならない
- **FR-021**: 時の番人のメイルを装備している状態で致命的なダメージを受けると、確率でダメージ前のHPと位置にロールバックしなければならない
- **FR-022**: 時間の残響ブーツを装備してダッシュすると、敵のターゲットを引くデコイ(残像エンティティ)を短時間召喚しなければならない
- **FR-023**: 不安定な懐中時計を使用すると、周囲のMobとプレイヤーの現在の速度ステータス効果を瞬時に入れ替えなければならない
- **FR-024**: プレイヤーがクロノスフィアで死亡した際のリスポーン処理は、オーバーワールドまたはクロノスフィア内の安全地点のいずれかに設定されなければならない
- **FR-025**: システムはサーバー負荷を抑えるため、既存のMinecraftシステム(ステータス効果、イベントフック)を最大限活用して時間特性を実装しなければならない

### Key Entities

- **クロックストーン**: クロノスフィアの基本素材。古代遺跡で発見でき、ポータル作成やアイテムの基本素材として使用される。
- **時の砂時計**: クロックストーンから作成される特殊アイテム。ポータルを起動してクロノスフィアへの突入を可能にする。
- **ポータル安定化装置**: 忘れられた図書館で設計図を発見し、クラフトによって作成される。機能停止したポータルを修復し、自由な往来を可能にする。
- **時間の果実**: クロノスフィア内で入手できる特殊な食料。満腹度回復と一時的な採掘速度上昇効果を持つ。
- **強化クロックストーン**: 砂漠の時計塔で入手できる上位素材。時間操作アイテムのレシピに必要。
- **タイムクロック**: 強化クロックストーンから作成されるユーティリティアイテム。使用すると周囲のMobの攻撃AIをキャンセルする(クールダウンあり)。
- **空間連結ツルハシ**: 強化クロックストーンから作成されるツール。ブロック破壊時に確率でドロップアイテムが2倍になる。
- **不安定な砂時計**: 究極アイテムの素材。クラフト時に反転共鳴を誘発するリスクを伴う。
- **マスタークロックへの鍵**: 時の番人を撃破すると入手できる重要アイテム。マスタークロック最深部への道を開く。
- **静止のコアの破片**: 時間の暴君を撃破すると入手できる最重要素材。究極のアーティファクトの作成に必須。
- **クロノスの瞳**: 時間の暴君を撃破すると入手できる究極のアーティファクト。獲得後、クロノスフィアのMobの速度低下がさらに強化される。
- **クロノブレード**: 静止のコアの破片から作成される究極の剣。攻撃命中時、確率でMobの次の攻撃AIをスキップする。
- **時の番人のメイル**: 静止のコアの破片から作成される究極のチェストプレート。致命的なダメージを受けた際、確率でダメージ前の状態にロールバックする。
- **時間の残響ブーツ**: 静止のコアの破片から作成される究極のブーツ。ダッシュ時に敵のターゲットを引くデコイを召喚する。
- **不安定な懐中時計**: 静止のコアの破片から作成される究極のユーティリティアイテム。使用時、周囲のMobとプレイヤーの速度ステータス効果を入れ替える。
- **古代遺跡**: オーバーワールドに生成される構造物。クロックストーンと時の砂時計の設計図を発見できる。
- **忘れられた図書館**: クロノスフィア内に生成される構造物。ポータル安定化装置の設計図を発見できる。
- **砂漠の時計塔**: クロノスフィア内に生成される構造物。強化クロックストーンを入手できる。
- **マスタークロック**: クロノスフィア内の最深部にある構造物。時間の暴君が待ち構えている。
- **時の番人**: クロノスフィア内に出現する中ボス。撃破するとマスタークロックへの鍵をドロップする。
- **時間の暴君**: マスタークロック最深部に出現するラスボス。ディメンションを永遠に静止させた元凶。撃破すると静止のコアの破片とクロノスの瞳を入手できる。
- **逆流の砂岩**: クロノスフィア内に生成される特殊ブロック。破壊後数秒で元の状態に修復される。
- **不安定な菌糸**: クロノスフィア内に生成される特殊ブロック。衝突したプレイヤーにランダムな速度効果を付与する。

## Assumptions and Dependencies

### Assumptions

- プレイヤーはMinecraftの基本操作(移動、採掘、クラフト、戦闘)に習熟していることを前提とする
- 確率発動の効果(クロノブレード、時の番人のメイルなど)の具体的な確率値は、実装後のバランス調整で決定される(推奨範囲: 10%～50%)
- 古代遺跡、忘れられた図書館、砂漠の時計塔、マスタークロックの構造物はプレイヤーが発見可能な範囲に生成される
- クロノスフィア内の時間特性(Mob速度低下、ブロック修復など)はプレイヤーの探索体験を損なわない程度に調整される
- サーバー環境では複数プレイヤーが同時にクロノスフィアに滞在する可能性があるが、個々のプレイヤー体験は独立している

### Dependencies

- Minecraftのバージョン: [実装時に決定 - 推奨: 最新の安定版または広く使用されているバージョン]
- Modローダー: [実装時に決定 - Forge, Fabric, NeoForgeなど]
- サーバー環境での動作を考慮した設計が必要
- 既存のMinecraftゲームシステム(ディメンション生成、ポータルメカニズム、エンティティ挙動、ステータス効果)に依存

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: プレイヤーはオーバーワールドで古代遺跡を発見し、10分以内にクロノスフィアへの突入に必要な素材と設計図を入手できる
- **SC-002**: プレイヤーはクロノスフィアに突入後、30分以内にポータル安定化装置を作成し、オーバーワールドへの帰還路を確保できる
- **SC-003**: クロノスフィア内のMobは通常のMobと比較して50%以上の速度低下が観察され、プレイヤーは戦略的な戦闘を行える
- **SC-004**: プレイヤーは砂漠の時計塔を探索し、20分以内に強化クロックストーンと時間操作アイテムを入手できる
- **SC-005**: プレイヤーは時の番人との戦闘を5回以内の試行で撃破し、マスタークロックへの鍵を入手できる
- **SC-006**: プレイヤーは時間の暴君との戦闘を10回以内の試行で撃破し、クロノスの瞳と静止のコアの破片を入手できる
- **SC-007**: プレイヤーは究極のアーティファクトを装備し、通常の装備と比較して戦闘効率が30%以上向上することを体感できる
- **SC-008**: サーバー負荷は既存のMinecraft環境と比較して10%以内の増加に抑えられる
- **SC-009**: プレイヤーの90%以上が、ポータル安定化装置の作成プロセスを理解し、初回プレイで帰還路を確保できる
- **SC-010**: プレイヤーの80%以上が、時間操作アイテムの効果を体感し、「時間を操作している」という独自性を評価する
